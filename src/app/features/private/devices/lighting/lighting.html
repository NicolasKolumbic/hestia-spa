<div class="p-6 bg-[var(--surface-50)] dark:bg-[var(--surface-900)] transition-colors duration-300">

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-[var(--surface-900)] dark:text-[var(--surface-0)]">
                Iluminación
            </h1>
            <p class="text-[var(--surface-500)] dark:text-[var(--surface-400)]">
                {{ devices().length }} dispositivos
            </p>
        </div>
        <p-button label="Apagar Todo" icon="pi pi-power-off" (onClick)="turnAllOff()"
            styleClass="!bg-[var(--surface-200)] !text-[var(--surface-700)] !border-transparent hover:!bg-[var(--surface-300)] dark:!bg-[var(--surface-800)] dark:!text-[var(--surface-300)] dark:hover:!text-white"></p-button>
    </div>

    <div class="mb-8">
        <h3 class="text-xs font-bold uppercase tracking-widest text-[var(--surface-500)] mb-3 pl-1">Ambientes</h3>
        <div class="flex gap-4 overflow-x-auto pb-2 scrollbar-hide">
            @for (scene of scenes; track scene.name) {
            <button (click)="activateScene(scene)"
                class="flex items-center gap-3 px-5 py-3 rounded-xl border transition-all duration-300 min-w-max group
                 bg-[var(--surface-0)] border-[var(--surface-200)] hover:border-orange-500 hover:shadow-lg
                 dark:bg-[var(--surface-800)] dark:border-[var(--surface-700)] dark:hover:border-orange-500 dark:hover:shadow-orange-900/20">
                <div
                    class="w-8 h-8 rounded-full flex items-center justify-center bg-[var(--surface-100)] dark:bg-[var(--surface-700)] group-hover:bg-orange-100 dark:group-hover:bg-orange-500/20 text-[var(--surface-600)] dark:text-[var(--surface-300)] group-hover:text-orange-600 dark:group-hover:text-orange-500 transition-colors">
                    <i [class]="'pi ' + scene.icon"></i>
                </div>
                <span class="font-medium text-[var(--surface-700)] dark:text-[var(--surface-200)]">{{ scene.name
                    }}</span>
            </button>
            }
        </div>
    </div>

    <h3 class="text-xs font-bold uppercase tracking-widest text-[var(--surface-500)] mb-3 pl-1">Dispositivos</h3>

    <hta-device-grid title="Iluminación" addLabel="Agregar Luz" [devices]="devices()" (add)="addHandler()">
        <ng-template #header let-device>
            <i class="pi pi-lightbulb text-2xl transition-colors duration-300"
                [style.color]="device.channels[0]?.isOn ? device.channels[0]?.color : 'var(--surface-400)'"
                [style.text-shadow]="device.channels[0]?.isOn ? '0 0 10px ' + device.channels[0]?.color : 'none'">
            </i>
            <h3 class="font-bold text-lg text-[var(--surface-900)] dark:text-[var(--surface-0)] leading-tight">
                {{ device.name }}
            </h3>
        </ng-template>
        <ng-template #content let-device>
            @for (channel of device.channels; track channel.channelId) {
            <hta-device-channel-control [channel]="channel" (toggleChanged)="toggleLight(channel)"
                (brightnessChanged)="updateBrightness(channel, $event)"
                (colorPickerRequested)="openColorPicker($event)">
            </hta-device-channel-control>
            }
        </ng-template>
    </hta-device-grid>
</div>

<p-dialog [(visible)]="displayColorPicker" styleClass="p-0 border-none shadow-2xl bg-[var(--surface-800)]">
    <div class="p-4 flex flex-col gap-3 w-64">
        <span class="text-sm font-bold text-white mb-1">Color de la Luz</span>

        <p-colorPicker [(ngModel)]="selectedLightColor"
            (onChange)="selectedLight && updateColor(selectedLight, $event.value.toString())" [inline]="true"
            styleClass="w-full"></p-colorPicker>

        <div class="flex justify-between gap-2 mt-2">
            @for (color of presetColors; track color) {
            <div (click)="selectedLight && updateColor(selectedLight, color)"
                class="w-6 h-6 rounded-full cursor-pointer hover:scale-110 transition-transform border border-white/20"
                [style.background-color]="color">
            </div>
            }
        </div>
    </div>
</p-dialog>

@if(showDialog()) {
<hta-dialog [title]="title()" [show]="showDialog()" (cancel)="cancelHandler()" (confirm)="confirmHandler($event)">
    <hta-lights-form [light]="selectedDevice()" #content />
</hta-dialog>
}